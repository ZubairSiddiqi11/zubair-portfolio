<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>MiniDate — Standalone</title>
<style>
  :root{
    --bg:#f6f8fb; --card:#fff; --accent:#ff3b6f; --muted:#6b7280;
    --shadow: 0 6px 18px rgba(15,23,42,0.08);
    font-family: Inter, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
  }
  *{box-sizing:border-box}
  body{margin:0;background:linear-gradient(180deg,#eef2f6, #f6f8fb);min-height:100vh;color:#0f172a}
  .app{max-width:1100px;margin:28px auto;padding:16px;display:grid;grid-template-columns:1fr 360px;gap:18px}
  header{grid-column:1 / -1;display:flex;align-items:center;justify-content:space-between;padding:12px 6px}
  header h1{margin:0;font-size:20px;letter-spacing:-0.2px}
  header p{margin:0;color:var(--muted);font-size:13px}

  .panel{background:var(--card);border-radius:12px;box-shadow:var(--shadow);padding:14px;min-height:520px}
  .discover{display:flex;flex-direction:column;align-items:center;justify-content:center;gap:12px;position:relative;overflow:hidden;height:600px}
  .cards-area{width:100%;max-width:420px;height:560px;position:relative}
  .card{position:absolute;inset:0;margin:0 auto;width:100%;max-width:420px;height:520px;border-radius:12px;background:linear-gradient(180deg,#ffffff,#fff);box-shadow:0 20px 40px rgba(2,6,23,0.06);overflow:hidden;touch-action:none;display:flex;flex-direction:column}
  .avatarTop{height:70%;display:flex;align-items:center;justify-content:center;background:linear-gradient(180deg, rgba(0,0,0,0.02), rgba(0,0,0,0.02));}
  .avatarInitial{width:92%;height:92%;border-radius:10px;display:flex;align-items:center;justify-content:center;font-size:48px;font-weight:700;color:white}
  .cardInfo{padding:14px;flex:1;display:flex;flex-direction:column;justify-content:space-between}
  .cardInfo h3{margin:0;font-size:20px}
  .cardInfo p{margin:6px 0 0;color:var(--muted);font-size:14px}
  .controls{display:flex;gap:12px;margin-top:10px}
  .btn{flex:1;padding:10px;border-radius:10px;border:0;font-weight:600;cursor:pointer}
  .btn.pass{background:#eef2f6;color:#0f172a}
  .btn.like{background:var(--accent);color:white}
  .small{font-size:13px;padding:8px 10px}

  /* matches column */
  .matchesList{display:flex;flex-direction:column;gap:10px}
  .matchItem{display:flex;gap:12px;align-items:center;padding:8px;border-radius:10px;cursor:pointer}
  .matchAvatar{width:52px;height:52px;border-radius:50%;display:flex;align-items:center;justify-content:center;color:white;font-weight:700}
  .matchName{font-weight:600}
  .matchSub{color:var(--muted);font-size:13px}
  .noMatches{color:var(--muted);font-size:14px;text-align:center;padding:30px 10px}

  /* modal */
  .overlay{position:fixed;inset:0;background:rgba(2,6,23,0.45);display:none;align-items:center;justify-content:center;z-index:60}
  .overlay.show{display:flex}
  .modal{width:90%;max-width:720px;background:white;border-radius:12px;padding:14px;box-shadow:var(--shadow);max-height:90vh;overflow:auto}
  .modalHeader{display:flex;align-items:center;justify-content:space-between}
  .chatArea{display:flex;flex-direction:column;height:60vh;gap:8px}
  .messages{flex:1;overflow:auto;padding-right:6px}
  .msg{max-width:70%;padding:10px;border-radius:12px;margin:6px 0;display:inline-block}
  .msg.me{margin-left:auto;background:#2563eb;color:white}
  .msg.them{background:#f1f5f9;color:#0f172a}
  .compose{display:flex;gap:8px;padding-top:8px}
  .compose input{flex:1;padding:10px;border-radius:10px;border:1px solid #e6eef8}
  .compose button{padding:10px 12px;border-radius:10px;background:var(--accent);color:white;border:0;cursor:pointer}

  /* little helpers */
  .pill{display:inline-block;padding:6px 10px;border-radius:999px;background:#f1f5f9;color:var(--muted);font-size:12px}
  @media (max-width:980px){
    .app{grid-template-columns:1fr; padding:8px}
    .panel{min-height:auto}
    .discover{height:auto}
  }
</style>
</head>
<body>
  <div class="app" id="app">
    <header>
      <div>
        <h1>MiniDate — Web Prototype</h1>
        <p>Simple local demo • Save as single HTML and open in browser</p>
      </div>
      <div style="display:flex;gap:10px;align-items:center">
        <span class="pill" id="profileCount">Profiles: 0</span>
        <button class="btn small" id="resetBtn" style="background:#f3f4f6;border-radius:8px">Reset Data</button>
      </div>
    </header>

    <section class="panel discover" aria-label="Discover">
      <div style="width:100%;display:flex;align-items:center;justify-content:center;flex-direction:column">
        <div style="max-width:420px;width:100%;display:flex;align-items:center;justify-content:space-between;padding:0 6px;margin-bottom:6px">
          <div><strong>Discover</strong><div style="color:var(--muted);font-size:13px">Swipe to like or pass</div></div>
          <div style="display:flex;gap:8px;align-items:center">
            <button id="shuffleBtn" class="btn small" style="background:#eef2f6">Shuffle</button>
            <button id="viewMatchesBtn" class="btn small" style="background:#fff;border:1px solid #eef2f6">Matches</button>
          </div>
        </div>

        <div class="cards-area" id="cardsArea" aria-live="polite">
          <!-- cards injected here -->
        </div>

        <div class="controls" style="max-width:420px;width:100%">
          <button class="btn pass" id="passBtn">Pass</button>
          <button class="btn like" id="likeBtn">Like</button>
        </div>
      </div>
    </section>

    <aside class="panel" aria-label="Matches">
      <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:10px">
        <strong>Matches</strong>
        <div style="color:var(--muted);font-size:13px" id="matchesCount">0</div>
      </div>

      <div class="matchesList" id="matchesList">
        <!-- matches populated here -->
      </div>
      <div style="margin-top:12px;color:var(--muted);font-size:13px">Tap a match to open chat. Data saved locally.</div>
    </aside>
  </div>

  <!-- Modal / Chat -->
  <div class="overlay" id="overlay" role="dialog" aria-hidden="true">
    <div class="modal" id="modal">
      <div class="modalHeader">
        <div>
          <h3 id="modalName" style="margin:0"></h3>
          <div id="modalBio" style="color:var(--muted);font-size:13px"></div>
        </div>
        <div style="display:flex;gap:8px;align-items:center">
          <button id="closeModal" class="btn small" style="background:#eef2f6">Close</button>
        </div>
      </div>

      <div style="height:12px"></div>

      <div class="chatArea">
        <div id="messages" class="messages" aria-live="polite"></div>

        <div class="compose">
          <input id="messageInput" placeholder="Write a message..." autocomplete="off"/>
          <button id="sendMsg">Send</button>
        </div>
      </div>
    </div>
  </div>

<script>
/* ------------------------------
   MiniDate — Standalone (vanilla)
   ------------------------------ */

(() => {
  // Utilities
  const $ = s => document.querySelector(s);
  const $$ = s => Array.from(document.querySelectorAll(s));
  const uid = () => '_' + Math.random().toString(36).slice(2,10);

  // DOM refs
  const cardsArea = $('#cardsArea');
  const profileCount = $('#profileCount');
  const likeBtn = $('#likeBtn');
  const passBtn = $('#passBtn');
  const shuffleBtn = $('#shuffleBtn');
  const resetBtn = $('#resetBtn');
  const matchesList = $('#matchesList');
  const matchesCount = $('#matchesCount');
  const overlay = $('#overlay');
  const modal = $('#modal');
  const modalName = $('#modalName');
  const modalBio = $('#modalBio');
  const messagesEl = $('#messages');
  const messageInput = $('#messageInput');
  const sendMsg = $('#sendMsg');
  const viewMatchesBtn = $('#viewMatchesBtn');

  // Local storage keys
  const LS = {
    PROFILES: 'mini_profiles_v1',
    LIKES: 'mini_likes_v1',
    MATCHES: 'mini_matches_v1',
    CHATS: 'mini_chats_v1'
  };

  // Default demo profiles (color + initials used for avatar)
  const defaultProfiles = [
    { id: 'p1', name: 'Aisha Khan', age: 24, bio: 'Loves hiking, chai, and late-night coding. Looking for someone to explore markets with.', color:'#f97316' },
    { id: 'p2', name: 'Omar Rahimi', age: 28, bio: 'Software dev • coffee snob • board game fan.', color:'#06b6d4' },
    { id: 'p3', name: 'Laila Noor', age: 26, bio: 'Photographer & traveler. Collects postcards and stories.', color:'#ef4444' },
    { id: 'p4', name: 'Karim Aziz', age: 27, bio: 'Foodie, amateur chef. I make a mean biryani.', color:'#a78bfa' },
    { id: 'p5', name: 'Mariam W.', age: 25, bio: 'Sociology student — loves documentaries & chai-time conversations.', color:'#34d399' }
  ];

  // State (kept in-memory + persisted)
  let profiles = [];
  let likes = []; // liked profile ids (by current user)
  let matches = []; // objects {id, profileId, matchedAt}
  let chats = {}; // profileId -> array of {id, fromMe, content, sentAt}

  // Load / Save
  function loadState(){
    try{
      profiles = JSON.parse(localStorage.getItem(LS.PROFILES)) || defaultProfiles.slice();
    } catch(e){ profiles = defaultProfiles.slice(); }
    try{ likes = JSON.parse(localStorage.getItem(LS.LIKES)) || []; } catch(e){ likes = []; }
    try{ matches = JSON.parse(localStorage.getItem(LS.MATCHES)) || []; } catch(e){ matches = []; }
    try{ chats = JSON.parse(localStorage.getItem(LS.CHATS)) || {}; } catch(e){ chats = {}; }
  }
  function saveState(){
    localStorage.setItem(LS.PROFILES, JSON.stringify(profiles));
    localStorage.setItem(LS.LIKES, JSON.stringify(likes));
    localStorage.setItem(LS.MATCHES, JSON.stringify(matches));
    localStorage.setItem(LS.CHATS, JSON.stringify(chats));
  }

  // Helpers for avatar (initials & color)
  function initials(name){
    return name.split(' ').map(s => s[0]).slice(0,2).join('').toUpperCase();
  }

  // Render functions
  function renderCards(){
    cardsArea.innerHTML = '';
    // create a stack: top card is last in array
    const copy = profiles.slice(); // clone
    copy.forEach((p, i) => {
      const idx = i;
      const card = document.createElement('div');
      card.className = 'card';
      card.style.zIndex = 100 + idx;
      card.style.transform = `translateY(${idx * 6}px) scale(${1 - (idx * 0.02)})`;
      card.innerHTML = `
        <div class="avatarTop">
          <div class="avatarInitial" style="background:${p.color}" aria-hidden="true">${initials(p.name)}</div>
        </div>
        <div class="cardInfo">
          <div>
            <h3>${p.name}, ${p.age}</h3>
            <p>${p.bio}</p>
          </div>
          <div style="display:flex;align-items:center;justify-content:space-between">
            <div class="pill">${Math.max(0, Math.floor(Math.random()*10)+1)} km away</div>
            <div style="display:flex;gap:8px">
              <button class="btn small" data-action="info">View</button>
            </div>
          </div>
        </div>
      `;
      // attach events for dragging and tapping
      attachCardGestures(card, p);
      cardsArea.appendChild(card);
    });
    profileCount.textContent = `Profiles: ${profiles.length}`;
  }

  function renderMatches(){
    matchesList.innerHTML = '';
    if(matches.length === 0){
      matchesList.innerHTML = `<div class="noMatches">No matches yet — like someone to match!</div>`;
    } else {
      matches.forEach(m => {
        const p = profiles.concat(defaultProfiles).find(x => x.id === m.profileId) || null;
        if(!p) return;
        const item = document.createElement('div');
        item.className = 'matchItem';
        item.innerHTML = `
          <div class="matchAvatar" style="background:${p.color}">${initials(p.name)}</div>
          <div style="flex:1">
            <div class="matchName">${p.name}</div>
            <div class="matchSub">Matched ${timeAgo(new Date(m.matchedAt))}</div>
          </div>
          <div><button class="btn small" data-open="${p.id}">Chat</button></div>
        `;
        // open chat
        item.querySelector('button[data-open]').addEventListener('click', () => openChat(p.id));
        matchesList.appendChild(item);
      });
    }
    matchesCount.textContent = matches.length;
  }

  // Utility: time ago
  function timeAgo(d){
    const diff = Math.floor((Date.now() - new Date(d)) / 1000);
    if(diff < 60) return `${diff}s`;
    if(diff < 3600) return `${Math.floor(diff/60)}m`;
    if(diff < 86400) return `${Math.floor(diff/3600)}h`;
    return `${Math.floor(diff/86400)}d`;
  }

  // Card gestures: drag to like/pass or use buttons
  function attachCardGestures(cardEl, profile){
    let startX = 0, startY = 0, currentX = 0, currentY = 0, startTime = 0;
    let dragging = false;

    // open info
    cardEl.querySelector('[data-action="info"]').addEventListener('click', (e) => {
      e.stopPropagation();
      openChat(profile.id, true); // open modal in profile mode
    });

    function onPointerDown(e){
      const ev = e.touches ? e.touches[0] : e;
      dragging = true;
      startX = ev.clientX;
      startY = ev.clientY;
      currentX = 0; currentY = 0;
      startTime = Date.now();
      cardEl.style.transition = 'none';
      document.addEventListener('pointermove', onPointerMove);
      document.addEventListener('pointerup', onPointerUp);
      document.addEventListener('touchmove', onPointerMove, {passive:false});
      document.addEventListener('touchend', onPointerUp);
    }

    function onPointerMove(e){
      if(!dragging) return;
      const ev = e.touches ? e.touches[0] : e;
      currentX = ev.clientX - startX;
      currentY = ev.clientY - startY;
      cardEl.style.transform = `translate(${currentX}px, ${currentY}px) rotate(${currentX/12}deg)`;
    }

    function onPointerUp(e){
      if(!dragging) return;
      dragging = false;
      cardEl.style.transition = 'transform 300ms ease';
      const velocity = currentX / (Date.now() - startTime + 1);
      const threshold = 120;
      if(currentX > threshold || velocity > 0.5){
        // like
        cardEl.style.transform = `translate(1200px, ${currentY}px) rotate(30deg)`;
        setTimeout(()=> { handleLike(profile.id); }, 250);
      } else if(currentX < -threshold || velocity < -0.5){
        // pass
        cardEl.style.transform = `translate(-1200px, ${currentY}px) rotate(-30deg)`;
        setTimeout(()=> { handlePass(profile.id); }, 250);
      } else {
        cardEl.style.transform = '';
        // restore stack transform by re-rendering
        setTimeout(()=> { renderCards(); }, 300);
      }
      document.removeEventListener('pointermove', onPointerMove);
      document.removeEventListener('pointerup', onPointerUp);
      document.removeEventListener('touchmove', onPointerMove);
      document.removeEventListener('touchend', onPointerUp);
    }

    // pointer events (works for mouse and touch)
    cardEl.addEventListener('pointerdown', onPointerDown);
    cardEl.addEventListener('touchstart', onPointerDown, {passive:true});
  }

  // Like / Pass handlers
  function handleLike(profileId){
    if(!likes.includes(profileId)) likes.push(profileId);
    // Create match immediately for demo:
    if(!matches.find(m => m.profileId === profileId)){
      matches.unshift({ id: uid(), profileId, matchedAt: new Date().toISOString() });
      // ensure chat exists
      chats[profileId] = chats[profileId] || [];
      // add a welcome message from them (demo)
      chats[profileId].push({ id: uid(), fromMe:false, content: `Hi! Thanks for the like — nice to meet you.`, sentAt: new Date().toISOString() });
    }
    // remove the profile from discovery list
    profiles = profiles.filter(p => p.id !== profileId);
    saveState();
    renderCards();
    renderMatches();
  }

  function handlePass(profileId){
    // remove from discovery only
    profiles = profiles.filter(p => p.id !== profileId);
    saveState();
    renderCards();
  }

  // Buttons actions
  likeBtn.addEventListener('click', () => {
    if(profiles.length === 0) return;
    const top = profiles[0];
    // animate a fake like: remove and call like handler
    handleLike(top.id);
  });
  passBtn.addEventListener('click', () => {
    if(profiles.length === 0) return;
    const top = profiles[0];
    handlePass(top.id);
  });
  shuffleBtn.addEventListener('click', () => {
    profiles = shuffleArray(profiles);
    saveState();
    renderCards();
  });
  resetBtn.addEventListener('click', () => {
    if(confirm('Reset demo data? This clears local storage for the app.')) {
      localStorage.removeItem(LS.PROFILES);
      localStorage.removeItem(LS.LIKES);
      localStorage.removeItem(LS.MATCHES);
      localStorage.removeItem(LS.CHATS);
      loadState();
      renderAll();
    }
  });

  viewMatchesBtn.addEventListener('click', () => {
    // scroll to matches (on narrow screens, open overlay with matches)
    const right = matchesList;
    right.scrollIntoView({behavior:'smooth'});
  });

  // Open chat/profile modal
  let currentOpenProfileId = null;
  function openChat(profileId, showProfileOnly=false){
    currentOpenProfileId = profileId;
    const p = profiles.concat(defaultProfiles).find(x => x.id === profileId);
    if(!p) return;
    modalName.textContent = `${p.name}, ${p.age || ''}`;
    modalBio.textContent = p.bio || '';
    renderMessages(profileId);
    overlay.classList.add('show');
    overlay.setAttribute('aria-hidden', 'false');
    // focus input if chat
    if(!showProfileOnly) setTimeout(()=> messageInput.focus(), 300);
  }
  $('#closeModal').addEventListener('click', () => closeModal());
  overlay.addEventListener('click', (e) => {
    if(e.target === overlay) closeModal();
  });

  function closeModal(){
    overlay.classList.remove('show');
    overlay.setAttribute('aria-hidden', 'true');
    currentOpenProfileId = null;
  }

  // messages rendering and sending
  function renderMessages(profileId){
    messagesEl.innerHTML = '';
    const arr = chats[profileId] || [];
    arr.forEach(m => {
      const el = document.createElement('div');
      el.className = 'msg ' + (m.fromMe ? 'me' : 'them');
      el.textContent = m.content;
      messagesEl.appendChild(el);
    });
    // scroll bottom
    messagesEl.scrollTop = messagesEl.scrollHeight;
  }

  sendMsg.addEventListener('click', sendMessageFromInput);
  messageInput.addEventListener('keydown', (e) => {
    if(e.key === 'Enter') sendMessageFromInput();
  });

  function sendMessageFromInput(){
    if(!currentOpenProfileId) return;
    const text = messageInput.value.trim();
    if(!text) return;
    const msg = { id: uid(), fromMe:true, content:text, sentAt: new Date().toISOString() };
    chats[currentOpenProfileId] = chats[currentOpenProfileId] || [];
    chats[currentOpenProfileId].push(msg);
    // demo: auto-reply
    setTimeout(()=> {
      chats[currentOpenProfileId].push({ id: uid(), fromMe:false, content:"Nice to hear from you!", sentAt: new Date().toISOString() });
      saveState();
      renderMessages(currentOpenProfileId);
    }, 700);
    messageInput.value = '';
    saveState();
    renderMessages(currentOpenProfileId);
  }

  // Open chat from matches panel faster
  function openChatFromPanel(profileId){
    openChat(profileId);
  }

  // small helper to shuffle
  function shuffleArray(a){
    const arr = a.slice();
    for(let i=arr.length-1;i>0;i--){
      const j=Math.floor(Math.random()*(i+1));
      [arr[i],arr[j]]=[arr[j],arr[i]];
    }
    return arr;
  }

  // Initialization
  function renderAll(){
    renderCards();
    renderMatches();
    saveState();
  }

  // load + render
  loadState();
  renderAll();

  // ensure top card is first element in array (for simplicity)
  // but pockets: top = profiles[0] (change in behavior as needed)

  // allow opening a chat when clicking a match button created elsewhere
  window.openChat = openChatFromPanel;

  // Edge: when user clicks a "Chat" button in matchesList, attach to window
  // already handled during renderMatches (attached to button)

  // small accessibility: keyboard shortcuts
  document.addEventListener('keydown', (e) => {
    if(e.key === 'ArrowRight') { likeBtn.click(); }
    if(e.key === 'ArrowLeft') { passBtn.click(); }
    if(e.key === 'Escape') { closeModal(); }
  });

})();
</script>
</body>
</html>